{{ define "conundrum" }}
  {{ template "conundrum-nav" . }}
  <p>conundrum...: {{ .Conundrum.Id }}</p>
  <p>date........: <span class="date">{{ .Conundrum.Date }}</span></p>
  {{ template "conundrum-author" .Conundrum }}
  <p>comments....: {{ len .Comments }}</p>
  {{ template "conundrum-stars" . }}
  {{ template "conundrum-verified" . }}
  <p
    class="conundrum-text {{ if not .Conundrum.Verified }}not-verified{{ end }}"
  >
    conundrum...: {{ .Conundrum.Text }}
  </p>
  {{ template "comments" .Comments }}
  <br>
  {{ template "comment-form" . }}
{{ end }}

{{ define "conundrum-author" }}
  <p>
    author......:
    <button
      hx-get="/author/{{ .Author }}"
      hx-target="main"
      hx-indicator="#conundrum-nav-loading"
    >
      {{ .Author }}
    </button>
  </p>
{{ end }}

{{ define "conundrum-stars" }}
  <p id="conundrum-stars">
    stars.......: {{ .Conundrum.Stars }}
    <button
      hx-post="/star/{{ .Conundrum.Id }}"
      hx-swap="outerHTML"
      hx-target="#conundrum-stars"
      hx-indicator="#conundrum-star-loading"
    >
      star{{ if .Starred }}-{{ else }}+{{ end }}
    </button>
    {{ template "indicator" "conundrum-star-loading" }}
  </p>
{{ end }}

{{ define "conundrum-verified" }}
  <p id="conundrum-verified">
    goated......:
    {{ if .TokenValid }}
      <button
        hx-post="/verify/{{ .Conundrum.Id }}"
        hx-swap="outerHTML"
        hx-target="#conundrum-verified"
        hx-indicator="#conundrum-verified-loading"
      >
        {{ .Conundrum.Verified }}
      </button>
      {{ template "indicator" "conundrum-verified-loading" }}
      </span>
    {{ else }}
      {{ .Conundrum.Verified }}
    {{ end }}
  </p>
{{ end }}

{{ define "conundrum-nav" }}
  <div class="conundrum-nav">
    <button
      {{ if eq .Prev 0 }}disabled{{ end }}
      hx-get="/conundrum/{{ .Prev }}"
      hx-target="main"
      hx-indicator="#conundrum-nav-loading"
    >
      &lt;-prev
    </button>
    {{ template "indicator" "conundrum-nav-loading" }}
    <button
      {{ if eq .Next 0 }}disabled{{ end }}
      hx-get="/conundrum/{{ .Next }}"
      hx-target="main"
      hx-indicator="#conundrum-nav-loading"
    >
      next-&gt;
    </button>
  </div>
{{ end }}

{{ define "comments" }}
  {{ if gt (len .) 0 }}
    {{ range . }}
      <br>
      <p>comment.....: {{ .Id }}</p>
      <p>date........: <span class="date">{{ .Date }}</span></p>
      {{ template "conundrum-author" . }}
      <p class="comment-text">comment.....:  {{ .Comment }}</p>
    {{ end }}
  {{ end }}
{{ end }}

{{ define "comment-form" }}
  <form hx-post="/comment" hx-target="#comment-form-result">
    <span>post comment:</span>
    <input required type="text" name="comment" placeholder="comment..." />
    <input type="hidden" name="conundrum-id" value="{{ .Conundrum.Id }}">
    {{ template "indicator" "comment-form-loading" }}
    <button type="submit">post+</button>
  </form>
  {{ template "comment-form-result" }}
{{ end }}

{{ define "comment-form-result" }}
  <span id="comment-form-result">
    {{ if  . }}
      <span hx-get="/conundrum/{{ . }}" hx-trigger="load" hx-target="main">
      </span>
    {{ end }}
  </span>
{{ end }}
